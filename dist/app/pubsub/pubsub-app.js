'use strict';var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if(typeof Reflect==='object'&&typeof Reflect.decorate==='function')r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;};var __metadata=this&&this.__metadata||function(k,v){if(typeof Reflect==='object'&&typeof Reflect.metadata==='function')return Reflect.metadata(k,v);};var __param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex);};};Object.defineProperty(exports,'__esModule',{value:true});require('reflect-metadata');const inversify_1=require('inversify');const cli_logger_1=require('../cli/cli.logger');const pubsub_channels_1=require('../../lib/topzap.pubsub-lib.git/pubsub-channels');const pubsub_message_1=require('../../lib/topzap.pubsub-lib.git/pubsub-message');const pubsub_types_1=require('../../lib/topzap.pubsub-lib.git/pubsub-types');const service_registry_1=require('./service-registry');const pubsub_core_1=require('../../lib/topzap.pubsub-lib.git/pubsub-core');const logging_service_1=require('../services/logging.service');let PubsubApp=class PubsubApp{constructor(pubsubCore,serviceRegistry,loggingService){this.pubsubCore=pubsubCore;this.serviceRegistry=serviceRegistry;this.loggingService=loggingService;}initApp(){let channels=[pubsub_channels_1.Channels.ServiceChannel,pubsub_channels_1.Channels.ServiceHello];this.pubsubCore.subscribe(channels);this.pubsubCore.onServiceHello(msg=>{this.serviceHello(msg);});this.pubsubCore.onServiceMessage(msg=>{this.handleServiceMessage(msg);});this.requestPingBack();}serviceHello(payload){this.loggingService.logService('hello',payload);if(payload&&payload.type===pubsub_types_1.ServiceType.VendorPriceService){cli_logger_1.Logger.logYellow('*** .VendorPriceService ::',payload);this.serviceRegistry.registerService(payload);}}handleServiceMessage(msg){cli_logger_1.Logger.logPurple('*** handleServiceMessage ::',msg);}requestPingBack(){let payload=new pubsub_message_1.PubsubPayload(pubsub_types_1.ServiceType.VendorPriceService,{});this.pubsubCore.publish(pubsub_channels_1.Channels.RequestHello,payload).then(res=>{cli_logger_1.Logger.logPurple('requestPingBack ::',res);}).catch(err=>{cli_logger_1.Logger.logError('requestPingBack :: err ::',err);});}};PubsubApp=__decorate([inversify_1.injectable(),__param(0,inversify_1.inject('IPubsubCore')),__param(1,inversify_1.inject('IServiceRegistry')),__param(2,inversify_1.inject('ILoggingService')),__metadata('design:paramtypes',[pubsub_core_1.PubsubCore,service_registry_1.ServiceRegistry,logging_service_1.LoggingService])],PubsubApp);exports.PubsubApp=PubsubApp;